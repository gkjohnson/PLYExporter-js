<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="./node_modules/three/build/three.min.js"></script>
    <script type="text/javascript" src="./node_modules/three/examples/js/loaders/PLYLoader.js"></script>
    <script type="text/javascript" src="./PLYExporter.js"></script>
    <script type="text/javascript" src="./PLYBinaryExporter.js"></script>



    <title></title>
</head>
<body>


    <script type="text/javascript">
        // https://stackoverflow.com/questions/19327749/javascript-blob-filename-without-link
        var saveData = (function () {
            var a = document.createElement("a");
            document.body.appendChild(a);
            a.style = "display: none";
            return function (data, fileName) {
                var blob = new Blob([ data ], { type: "octet/stream" }),
                    url = window.URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
            };
        }());

        // create the geometry
        var geometry = new THREE.SphereBufferGeometry( 5, 10, 10 );
        var material = new THREE.MeshBasicMaterial( {color: 0xffff00} );
        var mesh = new THREE.Mesh( geometry, material );

        // process into the file content
        var exp = new THREE.PLYExporter();
        var data = exp.parse(mesh, [ 'color' ]);

        console.log('ASCII Format');
        console.log(data);

        var binexp = new THREE.PLYBinaryExporter();
        var bindata = binexp.parse(mesh, [ 'color' ]);

        console.log('Binary Format');
        console.log(new TextDecoder().decode(bindata));

        // parse it back to geometry
        var loader = new THREE.PLYLoader();
        var res = loader.parse(data);

        console.log(res, geometry);

        // saveData(data, 'sphere.ply');
        
        console.log(geometry.index.array.join(',') === res.index.array.join(','));
        console.log(geometry.attributes.position.array.join(',') === res.attributes.position.array.join(','));
        console.log(geometry.attributes.normal.array.join(',') === res.attributes.normal.array.join(','));
        console.log(!geometry.attributes.color && !res.attributes.color);

    </script>
</body>
</html>